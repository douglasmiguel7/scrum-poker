<nz-water-mark nzContent="work in progress" [nzFont]="{ fontSize: 12 }">
  <nz-layout>
    <!-- page header -->
    <nz-header
      nzTheme="light"
      nz-flex
      nzJustify="space-between"
      nzAlign="center"
    >
      <h2 nz-typography class="!m-0">
        <span nz-icon nzType="fast-forward" nzTheme="outline"></span>
        Scrum Poker
      </h2>
      <div nz-flex nzAlign="center" nzGap="small">
        <nz-avatar nzText="D"></nz-avatar>
        Douglas
      </div>
    </nz-header>

    <nz-divider class="m-0"></nz-divider>

    <!-- page content header -->
    <nz-page-header>
      <nz-page-header-title>Minha mesa</nz-page-header-title>
      <nz-page-header-subtitle>
        criado por {{ createdBy }}
      </nz-page-header-subtitle>

      <nz-page-header-extra>
        <nz-space nzSize="middle">
          <countdown
            *nzSpaceItem
            [config]="countdownConfig"
            (event)="handleTimerEvent($event)"
          />
          <button
            *nzSpaceItem
            nz-button
            nzType="link"
            nz-dropdown
            nzTrigger="click"
            [nzDropdownMenu]="menu"
            [disabled]="countdownStarted"
          >
            <span nz-icon nzType="play-circle" nzTheme="outline"></span>
            Iniciar
            <span nz-icon nzType="down"></span>
          </button>
          <nz-dropdown-menu #menu="nzDropdownMenu">
            <ul nz-menu>
              @for (option of minutesOptions; track option) {
              <li nz-menu-item (click,keyup)="handleStartTimer(option)">
                <a>
                  @if (option === 1) {
                  {{ option }} minuto } @if (option > 1) { {{ option }} minutos
                  }
                </a>
              </li>
              }
            </ul>
          </nz-dropdown-menu>
          <button
            *nzSpaceItem
            nz-button
            nzType="link"
            class="!p-0"
            (click)="handleAddOneMinute()"
            [disabled]="!countdownStarted"
          >
            <span nz-icon nzType="plus-circle" nzTheme="outline"></span>
            Adicionar 1 minuto
          </button>
          <button
            *nzSpaceItem
            nz-button
            nzType="link"
            class="!p-0"
            (click)="handleRestartTimer()"
            [disabled]="!countdownStarted"
          >
            <span nz-icon nzType="redo" nzTheme="outline"></span>
            Reiniciar
          </button>
          <button
            *nzSpaceItem
            nz-button
            nzType="text"
            nzDanger
            class="!p-0"
            [disabled]="!countdownStarted"
            (click)="handleStopTimer()"
          >
            <span nz-icon nzType="close-circle" nzTheme="outline"></span>
            Parar
          </button>
          <nz-divider *nzSpaceItem class="!m-0" nzType="vertical"></nz-divider>
          <p
            *nzSpaceItem
            class="!m-0"
            nz-typography
            nzCopyable
            [nzCopyText]="inviteLink"
          >
            Copiar link do convite
          </p>
        </nz-space>
      </nz-page-header-extra>
    </nz-page-header>

    <nz-divider class="m-0"></nz-divider>

    <nz-layout>
      <!-- content left side -->
      <nz-sider class="overflow-x-hidden overflow-y-auto">
        <nz-space nzDirection="vertical" class="py-3 pl-3" nzSize="middle">
          <div *nzSpaceItem>
            <h4>Na mesa ({{ players.length }})</h4>
            <nz-space nzDirection="vertical">
              @for (player of players; track player) {
              <nz-space *nzSpaceItem nzAlign="baseline">
                <nz-avatar *nzSpaceItem [nzText]="player.charAt(0)" />
                <span
                  *nzSpaceItem
                  nz-typography
                  nzEllipsis
                  class="w-32"
                  nz-tooltip
                  [nzTooltipTitle]="player"
                  nzTooltipPlacement="right"
                >
                  {{ player }}
                </span>
              </nz-space>
              }
            </nz-space>
          </div>

          <div *nzSpaceItem>
            <h4>Assistindo ({{ spectators.length }})</h4>
            <nz-space nzDirection="vertical">
              @for (spectator of spectators; track spectator) {
              <nz-space *nzSpaceItem nzAlign="baseline">
                <nz-avatar *nzSpaceItem [nzText]="spectator.charAt(0)" />
                <span
                  *nzSpaceItem
                  nz-typography
                  nzEllipsis
                  class="w-32"
                  nz-tooltip
                  [nzTooltipTitle]="spectator"
                  nzTooltipPlacement="right"
                >
                  {{ spectator }}
                </span>
              </nz-space>
              }
            </nz-space>
          </div>
        </nz-space>
      </nz-sider>

      <!-- content center -->
      <nz-content>
        <div class="h-full" nz-flex nzJustify="center" nzAlign="center">
          <nz-card>
            <nz-space nzDirection="vertical">
              <nz-space nzDirection="vertical" nzAlign="center" nzSize="middle">
                <h2 *nzSpaceItem nz-typography class="!m-0">
                  Escolha sua carta!
                </h2>
                <button
                  *nzSpaceItem
                  nz-button
                  nzSize="large"
                  nzType="primary"
                  [disabled]="!allVoted"
                >
                  @if (allVoted) { Revelar cartas } @else { Aguardando 1 voto }
                </button>
              </nz-space>

              <nz-space nzDirection="vertical" nzAlign="center" nzSize="middle">
                <nz-space
                  *nzSpaceItem
                  nzDirection="vertical"
                  nzAlign="center"
                  nzSize="small"
                >
                  <h2 *nzSpaceItem nz-typography class="!m-0">Votos</h2>
                  <nz-space *nzSpaceItem nzSize="small">
                    @for (item of items; track $index) {
                    <nz-space
                      *nzSpaceItem
                      nzDirection="vertical"
                      nzAlign="center"
                      [nzSize]="0"
                    >
                      <span *nzSpaceItem nz-typography>Jogador</span>
                      <button
                        *nzSpaceItem
                        nz-button
                        class="overflow-hidden !p-0 !w-10 !h-16 !cursor-default"
                        nzSize="large"
                        nzType="primary"
                      >
                        0
                      </button>
                    </nz-space>
                    }
                  </nz-space>
                </nz-space>

                <nz-space
                  *nzSpaceItem
                  nzDirection="vertical"
                  nzAlign="center"
                  nzSize="small"
                >
                  <h2 *nzSpaceItem nz-typography class="!m-0">Resultado</h2>
                  <nz-space *nzSpaceItem nzSize="small">
                    @for (item of items; track $index) {
                    <nz-space
                      *nzSpaceItem
                      nzDirection="vertical"
                      nzAlign="center"
                      [nzSize]="0"
                    >
                      <span *nzSpaceItem nz-typography>10 votos</span>
                      <button
                        *nzSpaceItem
                        nz-button
                        class="overflow-hidden !p-0 !w-10 !h-16 !cursor-default"
                        nzSize="large"
                        nzType="primary"
                      >
                        0
                      </button>
                    </nz-space>
                    }
                  </nz-space>
                </nz-space>

                <nz-space *nzSpaceItem nzSize="large">
                  <nz-space
                    *nzSpaceItem
                    nzSize="small"
                    nzAlign="center"
                    nzDirection="vertical"
                    [nzSize]="0"
                  >
                    <h2 *nzSpaceItem nz-typography class="!m-0">Total</h2>
                    <h2 *nzSpaceItem nz-typography class="!m-0">0</h2>
                  </nz-space>

                  <nz-space
                    *nzSpaceItem
                    nzSize="small"
                    nzAlign="center"
                    nzDirection="vertical"
                    [nzSize]="0"
                  >
                    <h2 *nzSpaceItem nz-typography class="!m-0">Média</h2>
                    <h2 *nzSpaceItem nz-typography class="!m-0">0</h2>
                  </nz-space>
                </nz-space>
              </nz-space>
            </nz-space>
          </nz-card>
        </div>
      </nz-content>

      <!-- content right side -->
      <nz-sider [nzWidth]="250" class="overflow-x-hidden overflow-y-auto">
        <nz-space nzDirection="vertical" class="p-3 w-full" nzSize="small">
          <div *nzSpaceItem>
            <h4>Tarefas</h4>
            <nz-space [nzSplit]="spaceSplit">
              <ng-template #spaceSplit>•</ng-template>

              <span *nzSpaceItem>{{ tasks.length }} tarefas</span>
              <span *nzSpaceItem>{{ estimation }} estimativa</span>
            </nz-space>
          </div>

          <div *nzSpaceItem>
            <!-- add another task button -->
            <div [class.hidden]="toggleAddAnotherTask" class="mb-2">
              <button
                nz-button
                nzType="link"
                class="!p-0"
                (click)="handleToggleAddAnotherTask()"
              >
                <span nz-icon nzType="plus-circle" nzTheme="outline"></span>
                Adicionar outra tarefa
              </button>
            </div>

            <!-- add another task form -->
            <div [class.hidden]="!toggleAddAnotherTask">
              <form nz-form nzLayout="vertical">
                <nz-form-item>
                  <nz-form-label nzRequired nzLabelWrap>Título</nz-form-label>
                  <nz-form-control>
                    <input nz-input formControlName="title" />
                  </nz-form-control>
                </nz-form-item>
                <nz-form-item>
                  <nz-form-label nzLabelWrap>Link</nz-form-label>
                  <nz-form-control>
                    <input nz-input formControlName="link" />
                  </nz-form-control>
                </nz-form-item>
              </form>
              <nz-space nzSize="large">
                <button
                  *nzSpaceItem
                  nz-button
                  nzType="link"
                  nzDanger
                  class="!p-0"
                  (click)="handleToggleAddAnotherTask()"
                >
                  Cancelar
                </button>
                <button *nzSpaceItem nz-button nzType="link" class="!p-0">
                  Salvar
                </button>
              </nz-space>
            </div>
          </div>

          <!-- tasks -->
          <div *nzSpaceItem>
            <nz-space nzDirection="vertical" class="w-full">
              @for (task of tasks; track task) {
              <nz-card *nzSpaceItem nzHoverable class="cursor-default">
                <p
                  nz-typography
                  nzEditable
                  nzEditTooltip="Alterar título"
                  [(nzContent)]="task.title"
                >
                  {{ task.title }}
                </p>

                @if (task.link) {
                <p>
                  <a
                    [href]="task.link"
                    target="_blank"
                    nz-typography
                    nzEllipsis
                    class="w-full"
                    nzEditable
                    nzEditTooltip="Alterar link"
                    [(nzContent)]="task.link"
                  >
                    {{ task.link }}
                  </a>
                </p>
                }

                <button
                  nz-button
                  [nzType]="votingTask === task.id ? 'primary' : 'dashed'"
                  (click)="handleTaskToVote(task.id)"
                >
                  @if (votingTask !== task.id) { Votar essa tarefa } @if
                  (votingTask === task.id) { Votando essa tarefa }
                </button>
              </nz-card>
              }
            </nz-space>
          </div>
        </nz-space>
      </nz-sider>
    </nz-layout>

    <nz-divider class="m-0"></nz-divider>

    <!-- page footer -->
    <nz-footer nz-flex nzJustify="center" nzGap="large">
      @for (card of cards; track card) {
      <button
        nz-button
        class="overflow-hidden !p-0 !w-10 !h-16"
        nzSize="large"
        [nzType]="votedCardId === card.id ? 'primary' : 'dashed'"
        (click)="handleVote(card.id)"
      >
        @if (card.text) {
        {{ card.text }}
        } @else if (card.icon) {
        <span nz-icon [nzType]="card.icon" nzTheme="outline"></span>
        }
      </button>
      }
    </nz-footer>
  </nz-layout>
</nz-water-mark>
